<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Admin Produk</title>
  <style>
    body {background:#f9f9f9; font-family:sans-serif; margin:0; padding:0;}
    .container {max-width:420px; margin:32px auto 0 auto; background:#fff; border-radius:10px; box-shadow:0 2px 12px #0001; padding:28px 18px;}
    h2 {margin:0 0 18px 0; color:#ff5722;}
    form {display:flex; flex-direction:column; gap:12px;}
    input, textarea, select {padding:9px; font-size:1rem; border-radius:6px; border:1px solid #ddd;}
    textarea {resize:vertical;}
    button[type="submit"] {background:#ff5722; color:#fff;font-weight:bold; border:none; border-radius:6px; padding:10px; font-size:1.07rem;}
    button[type="submit"]:hover {background:#e64a19;}
    .img-preview {max-width:90px; max-height:90px; border-radius:8px; margin-top:6px;}
    .produk-list {margin-top:28px;}
    .produk-item {display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid #eee;}
    .produk-item img {width:38px;height:38px;border-radius:5px;object-fit:cover;}
    .produk-info {flex:1;}
    .produk-title {font-weight:bold;}
    .produk-kat {color:#ff5722;font-size:0.94rem;}
    .del-btn {background:#eee;color:#d00;border:none;border-radius:4px;padding:3px 9px;cursor:pointer;}
    @media (max-width:500px){.container{margin:0; border-radius:0; box-shadow:none;}}
  </style>
</head>
<body>
  <div class="container">
    <h2>Tambah Produk Baru</h2>
    <form id="formProduk">
      <input required type="text" id="nama" placeholder="Nama produk">
      <input required type="number" id="harga" placeholder="Harga (Rp)">
      <select required id="kategori">
        <option value="">Pilih Kategori</option>
        <option>Elektronik</option>
        <option>Fashion</option>
        <option>Kesehatan</option>
        <option>Rumah</option>
        <option>Makanan</option>
        <option>Olahraga</option>
        <option>Ibu & Anak</option>
        <option>Lainnya</option>
      </select>
      <textarea id="deskripsi" rows="2" placeholder="Deskripsi produk"></textarea>
      <label>
        Foto produk:
        <input required type="file" id="gambar" accept="image/*">
        <img id="imgPreview" class="img-preview" style="display:none;">
      </label>
      <button type="submit">Tambah Produk</button>
    </form>
    <div class="produk-list" id="produkList"></div>
  </div>
  <script>
    // Load produk dari localStorage
    function loadProduk() {
      return JSON.parse(localStorage.getItem('products') || '[]');
    }
    function saveProduk(arr) {
      localStorage.setItem('products', JSON.stringify(arr));
    }
    function renderProdukList() {
      const list = document.getElementById('produkList');
      const data = loadProduk();
      if(data.length === 0) {
        list.innerHTML = "<div style='color:#aaa; text-align:center;'>Belum ada produk.</div>";
        return;
      }
      list.innerHTML = "<b>Daftar Produk:</b>";
      data.slice().reverse().forEach((p, i) => {
        // index asli di storage
        const idx = data.length - 1 - i;
        list.innerHTML += `
          <div class="produk-item">
            <img src="${p.img}">
            <div class="produk-info">
              <div class="produk-title">${p.name}</div>
              <div class="produk-kat">${p.category}</div>
              <div style="font-size:0.96rem;color:#555;">Rp${p.price.toLocaleString("id-ID")}</div>
            </div>
            <button class="del-btn" onclick="hapusProduk(${idx})">Hapus</button>
          </div>
        `;
      });
    }
    function hapusProduk(idx) {
      if(!confirm("Yakin hapus produk ini?")) return;
      let data = loadProduk();
      data.splice(idx,1);
      saveProduk(data);
      renderProdukList();
      alert("Produk dihapus!");
    }
    // Preview gambar
    const gambarInput = document.getElementById('gambar');
    const imgPreview = document.getElementById('imgPreview');
    gambarInput.onchange = function() {
      const file = gambarInput.files[0];
      if(file) {
        const reader = new FileReader();
        reader.onload = e => {
          imgPreview.src = e.target.result;
          imgPreview.style.display = "block";
        };
        reader.readAsDataURL(file);
      } else {
        imgPreview.style.display = "none";
      }
    };
    // Submit produk
    document.getElementById('formProduk').onsubmit = function(e){
      e.preventDefault();
      const name = document.getElementById('nama').value.trim();
      const price = parseInt(document.getElementById('harga').value,10);
      const category = document.getElementById('kategori').value;
      const desc = document.getElementById('deskripsi').value.trim();
      const file = gambarInput.files[0];
      if(!file) return alert("Pilih gambar produk.");
      const reader = new FileReader();
      reader.onload = function(evt){
        const img = evt.target.result;
        const produkBaru = {name, price, category, desc, img};
        let arr = loadProduk();
        arr.push(produkBaru);
        saveProduk(arr);
        alert("Produk berhasil ditambahkan!");
        document.getElementById('formProduk').reset();
        imgPreview.style.display = "none";
        renderProdukList();
      };
      reader.readAsDataURL(file);
    };
    // Inisialisasi
    renderProdukList();
  </script>
</body>
</html>
